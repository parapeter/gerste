<div align=center>

# GER*S*TE

<img src="https://i.ibb.co/RBX0Pgc/gerste-logo.png" width="180" height="175">

**GER**man-"***S**ecure"*-**T**ime-**E**ditor


[![Linux](https://img.shields.io/badge/Linux-FCC624?style=for-the-badge&logo=linux&logoColor=black)](https://kernel.org/) [![made-with-bash](https://img.shields.io/badge/-Made%20with%20Bash-1f425f.svg?style=for-the-badge&logo=image%2Fpng%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw%2FeHBhY2tldCBiZWdpbj0i77u%2FIiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8%2BIDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTExIDc5LjE1ODMyNSwgMjAxNS8wOS8xMC0wMToxMDoyMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkE3MDg2QTAyQUZCMzExRTVBMkQxRDMzMkJDMUQ4RDk3IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkE3MDg2QTAzQUZCMzExRTVBMkQxRDMzMkJDMUQ4RDk3Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6QTcwODZBMDBBRkIzMTFFNUEyRDFEMzMyQkMxRDhEOTciIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6QTcwODZBMDFBRkIzMTFFNUEyRDFEMzMyQkMxRDhEOTciLz4gPC9yZGY6RGVzY3JpcHRpb24%2BIDwvcmRmOlJERj4gPC94OnhtcG1ldGE%2BIDw%2FeHBhY2tldCBlbmQ9InIiPz6lm45hAAADkklEQVR42qyVa0yTVxzGn7d9Wy03MS2ii8s%2BeokYNQSVhCzOjXZOFNF4jx%2BMRmPUMEUEqVG36jo2thizLSQSMd4N8ZoQ8RKjJtooaCpK6ZoCtRXKpRempbTv5ey83bhkAUphz8fznvP8znn%2B%2F3NeEEJgNBoRRSmz0ub%2FfuxEacBg%2FDmYtiCjgo5NG2mBXq%2BH5I1ogMRk9Zbd%2BQU2e1ML6VPLOyf5tvBQ8yT1lG10imxsABm7SLs898GTpyYynEzP60hO3trHDKvMigUwdeaceacqzp7nOI4n0SSIIjl36ao4Z356OV07fSQAk6xJ3XGg%2BLCr1d1OYlVHp4eUHPnerU79ZA%2F1kuv1JQMAg%2BE4O2P23EumF3VkvHprsZKMzKwbRUXFEyTvSIEmTVbrysp%2BWr8wfQHGK6WChVa3bKUmdWou%2BjpArdGkzZ41c1zG%2Fu5uGH4swzd561F%2BuhIT4%2BLnSuPsv9%2BJKIpjNr9dXYOyk7%2FBZrcjIT4eCnoKgedJP4BEqhG77E3NKP31FO7cfQA5K0dSYuLgz2TwCWJSOBzG6crzKK%2BohNfni%2Bx6OMUMMNe%2Fgf7ocbw0v0acKg6J8Ql0q%2BT%2FAXR5PNi5dz9c71upuQqCKFAD%2BYhrZLEAmpodaHO3Qy6TI3NhBpbrshGtOWKOSMYwYGQM8nJzoFJNxP2HjyIQho4PewK6hBktoDcUwtIln4PjOWzflQ%2Be5yl0yCCYgYikTclGlxadio%2BBQCSiW1UXoVGrKYwH4RgMrjU1HAB4vR6LzWYfFUCKxfS8Ftk5qxHoCUQAUkRJaSEokkV6Y%2F%2BJUOC4hn6A39NVXVBYeNP8piH6HeA4fPbpdBQV5KOx0QaL1YppX3Jgk0TwH2Vg6S3u%2BdB91%2B%2FpuNYPYFl5uP5V7ZqvsrX7jxqMXR6ff3gCQSTzFI0a1TX3wIs8ul%2Bq4HuWAAiM39vhOuR1O1fQ2gT%2F26Z8Z5vrl2OHi9OXZn995nLV9aFfS6UC9JeJPfuK0NBohWpCHMSAAsFe74WWP%2BvT25wtP9Bpob6uGqqyDnOtaeumjRu%2ByFu36VntK%2FPA5umTJeUtPWZSU9BCgud661odVp3DZtkc7AnYR33RRC708PrVi1larW7XwZIjLnd7R6SgSqWSNjU1B3F72pz5TZbXmX5vV81Yb7Lg7XT%2FUXriu8XLVqw6c6XqWnBKiiYU%2BMt3wWF7u7i91XlSEITwSAZ%2FCzAAHsJVbwXYFFEAAAAASUVORK5CYII%3D)](https://www.gnu.org/software/bash/) [![Badge License](https://img.shields.io/badge/License-GPL3-015d93.svg?style=for-the-badge&labelColor=blue)](https://github.com/parapeter/gerste/blob/main/LICENSE)

</div>

> [!WARNING]
> This bash script is only as secure as the webservers which gets triggered and only as secure as the connection itself.

This tiny bash script provides an one-time system clock update *(no daemon)*. Utilizing `curl`, it fetches the HTTP headers from a specified domain or IP address. From there `grep` extracts the timestamp and `date` adjusts the system clock based on your local timezone. By default, traffic is routed over HTTPS, with an optional way to route it through `tor`.

While originally designed for Germany (CET/CEST timezone), this script has been usable with any timezone since `version 0.5.1.`. Without keeping this in mind the first impulse for a name was `gerste` (likely influenced by its connection to beer?).

> [!NOTE]
> This project is still in it's early development and should not be used in any production environment. Help is always welcome.

Got inspired by [secure-time-sync](https://github.com/Obscurix/Obscurix/blob/master/airootfs/usr/lib/obscurix/secure-time-sync).

## :notebook_with_decorative_cover: Table of contents
- [Preparation](https://github.com/parapeter/gerste?tab=readme-ov-file#hammer_and_wrench-preparation)
- [Installation](https://github.com/parapeter/gerste?tab=readme-ov-file#cd-installation)
- [Configuration](https://github.com/parapeter/gerste?tab=readme-ov-file#gear-configuration)
- [Usage](https://github.com/parapeter/gerste?tab=readme-ov-file#rocket-usage)
- [Uninstall](https://github.com/parapeter/gerste?tab=readme-ov-file#wastebasket-uninstall)
- [Why?](https://github.com/parapeter/gerste?tab=readme-ov-file#question-why)
- [Contact](https://github.com/parapeter/gerste?tab=readme-ov-file#envelope-contact)

## :hammer_and_wrench: Preparation

1. The executing user needs root access
2. Make sure that `/etc/localtime` is set correctly

```bash
  $ ln -sf /usr/share/zoneinfo/Your/Timezone /etc/localtime
```

3. Install dependencies

```bash
  # Arch based systems
  $ pacman -S curl date grep
  # Debian based systems
  $ apt install curl date grep
```

4. **Optional:** Install and enable dependencies for using `gerste` through `tor`

```bash
  # Arch based systems
  $ pacman -S tor
  # Debian based systems
  $ apt install tor

  $ systemctl start tor.service
```
*Ensure you use the **standard port 9050 on localhost** for `tor`. Otherwise, you'll need to modify the script `gerste.sh` for now.*

## :cd: Installation

```bash
  $ git clone https://github.com/parapeter/gerste.git
  $ cd gerste
  $ ./install.sh
```

*Feel free to handle it manually if you prefer.*

## :gear: Configuration

Open the configuration file using your preferred text editor:


```bash
  $ nano /etc/gerste.conf
```

You can add or remove URLs *(or IPs)* that `curl` will query. For `[HTTPS-URLs]`, only https URLs and IP addresses are accepted, while for `[TOR-URLs]` you must provide `.onion` URLs.

> [!NOTE] 
> By default the config file is only read- and writable by root.

To check if your URL or IP address is compatible with this script simply run the following command *(replace `$url` with your IP or domain)*:


- **HTTPS**
```bash
curl --cacert /etc/ssl/certs/ca-certificates.crt --head --silent --no-keepalive --tlsv1.3 --junk-session-cookies --max-redirs 0 --max-time 10 --referer "" "$url" 2>&1 | grep -i "Date:" | grep -o "[0-2][0-9]:[0-5][0-9]:[0-5][0-9]"
```

- **TOR**
```bash
curl --socks5-hostname localhost:9050 --head --silent --no-keepalive --tlsv1.3 --junk-session-cookies --max-redirs 0 --max-time 10 --referer "" "$url" 2>&1 | grep -i "Date:" | grep -o "[0-2][0-9]:[0-5][0-9]:[0-5][0-9]"
```

## :rocket: Usage

```
SYNOPSIS
       gerste [OPTIONS]

OPTIONS
       -d, --dry-run
              Displays the fetched time without changing systemtime.

       -t, --tor
              Routes all network requests through the Tor network using torsocks. Ensure that 
              torsocks and the tor service are installed and running before using this option.

       -v, --version
              Displays the current version of gerste and exits.

EXAMPLES
       gerste
              Synchronizes system time using URLs specified in the configuration file.

       gerste -t -d
              Displays the fetched time through the TOR network.

       gerste --version
              Displays the version information.

FILES
       /etc/gerste.conf
              Configuration file for gerste, containing URL lists for time synchronization.
              The file should define sections [TOR-URLS] and [HTTPS-URLS] to separate 
              Tor-specific and https-web URLs.
```

## :wastebasket: Uninstall
```bash
  $ cd download-path/gerste
  $ sudo ./install.sh -u
```

## :question: Why
While `NTP` is a solid, enterprise-grade solution, this script presents an alternative for users who may want something different. Due to the script's naive approach, it should not be directly compared to the robustness and reliability of a good `NTP` configuration.

## :envelope: Contact

**Mail:** parapeter-git@proton.me